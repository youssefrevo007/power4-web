<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Choisissez vos ballons — Puissance 4</title>
    <link rel="stylesheet" href="/assets/static/style/Style.css">
  </head>
  <body>
    <video autoplay muted loop id="fondquibrille">
      <source src="/assets/video/Arriéreplan.mp4.mp4" type="video/mp4">
    </video>
    <div class="overlay"></div>
    <main class="hero">
      <div class="home-card" style="max-width:900px;">
        <h2 class="card-title">Choisissez votre ballon</h2>
        <p class="subtitle">Sélectionnez un style pour chaque joueur</p>

        <form action="/create" method="post" class="choose-form">
          <input type="hidden" name="mode" value="{{.Mode}}">
          <input type="hidden" name="name1" value="{{.Name1}}">
          <input type="hidden" name="name2" value="{{.Name2}}">

          <div class="choose-grid">
            <div class="choose-player">
              <h3>Joueur 1 — {{.Name1}}</h3>
              <div class="balls">
                <label class="ball-option">
                  <input type="radio" name="ball1" value="star" checked>
                  <span class="ball star">★</span>
                  <div class="ball-name">Dragon Star</div>
                </label>
                <label class="ball-option">
                  <input type="radio" name="ball1" value="galaxy">
                  <span class="ball galaxy"></span>
                  <div class="ball-name">Galaxy Orb</div>
                </label>
                <label class="ball-option">
                  <input type="radio" name="ball1" value="neon">
                  <span class="ball neon"></span>
                  <div class="ball-name">Neon Core</div>
                </label>
                <label class="ball-option">
                  <input type="radio" name="ball1" value="ajout1">
                  <span class="ball ajout1"></span>
                  <div class="ball-name">AJOUT1</div>
                </label>
                <label class="ball-option">
                  <input type="radio" name="ball1" value="ajout2">
                  <span class="ball ajout2"></span>
                  <div class="ball-name">AJOUT2</div>
                </label>
              </div>
            </div>

            <div class="choose-player">
              <h3>Joueur 2 — {{.Name2}}</h3>
              <div class="balls">
                <label class="ball-option">
                  <input type="radio" name="ball2" value="star" checked>
                  <span class="ball star">★</span>
                  <div class="ball-name">Dragon Star</div>
                </label>
                <label class="ball-option">
                  <input type="radio" name="ball2" value="galaxy">
                  <span class="ball galaxy"></span>
                  <div class="ball-name">Galaxy Orb</div>
                </label>
                <label class="ball-option">
                  <input type="radio" name="ball2" value="neon">
                  <span class="ball neon"></span>
                  <div class="ball-name">Neon Core</div>
                </label>
                <label class="ball-option">
                  <input type="radio" name="ball2" value="ajout1">
                  <span class="ball ajout1"></span>
                  <div class="ball-name">AJOUT1</div>
                </label>
                <label class="ball-option">
                  <input type="radio" name="ball2" value="ajout2">
                  <span class="ball ajout2"></span>
                  <div class="ball-name">AJOUT2</div>
                </label>
              </div>
            </div>
          </div>

          <div style="text-align:center;margin-top:18px;">
            <button type="submit" class="start-button large">Lancer la partie</button>
            <a href="/start" class="button-class" style="margin-left:12px;">Retour</a>
          </div>
        </form>
      </div>
    </main>
    <script>
      (function(){
        const rand = (min,max)=> Math.random()*(max-min)+min;
        // apply persisted theme and swap background video if present
        const savedTheme = localStorage.getItem('pf4-theme');
        function applyThemeToPage(theme){
          if(!theme) return;
          document.body.classList.add('theme-' + theme);
          const vid = document.getElementById('fondquibrille');
          if (vid && vid.querySelector) {
            const source = vid.querySelector('source');
            let candidate;
            if (theme === 'principal') candidate = '/assets/video/Arriéreplan.mp4.mp4';
            else if (theme === 'dragon' || theme === 'pokemon') candidate = '/assets/video/pokemon.mp4';
            else if (theme === 'sport') candidate = '/assets/video/FOOTBALL.MP4.mp4';
            else candidate = '/assets/video/' + theme + '-background.mp4';
            if (source) { source.src = candidate; vid.load(); }
          }
        }
        if (savedTheme) applyThemeToPage(savedTheme);
        // Map token ids to human-friendly names per theme
        const BALL_NAMES = {
          principal: {
            star: 'Solar Globe',
            galaxy: 'Aurora Orb',
            neon: 'Neon Pulse',
            ajout1: 'Amber Sphere',
            ajout2: 'Stone Orb'
          },
          sport: {
            star: 'Basketball',
            galaxy: 'Rugby Ball',
            neon: 'Football',
            ajout1: 'Tennis Ball',
            ajout2: 'Volleyball'
          },
          dragon: {
            star: '4‑Star Dragon',
            galaxy: 'Orange Orb',
            neon: 'Blue Orb',
            ajout1: 'Red Orb',
            ajout2: 'Gold Orb'
          },
          // Pokémon theme — uses your uploaded POKE images
          // Use the real Pokémon names for the uploaded images
          pokemon: {
            star: 'Carapuce',
            galaxy: 'Pokémon',
            neon: 'Bulbizarre',
            ajout1: 'Noctali',
            ajout2: 'Poké Ball'
          },
          ynov: {
            star: 'Neon 1', galaxy: 'Neon 2', neon: 'Neon 3', ajout1: 'Neon 4', ajout2: 'Neon 5'
          }
        };

        function applyBallNames(theme){
          const names = BALL_NAMES[theme] || BALL_NAMES['principal'];
          document.querySelectorAll('.ball-option').forEach(opt =>{
            const input = opt.querySelector('input[type=radio]');
            if(!input) return;
            const id = input.value;
            const nameEl = opt.querySelector('.ball-name');
            if(nameEl) nameEl.textContent = names[id] || id;
          });
        }
        // apply names right away
        applyBallNames(savedTheme || 'principal');
        function createBall(){
          if (window.innerWidth < 480 && Math.random() > 0.45) return;
          const ball = document.createElement('div');
          ball.className = 'falling-ball ' + (Math.random()>0.5? 'red':'orange');
          const size = Math.round(rand(12,44));
          ball.style.width = size + 'px';
          ball.style.height = size + 'px';
          ball.style.left = Math.round(rand(0, window.innerWidth - size)) + 'px';
          const duration = Math.round(rand(4200, 11000));
          ball.style.animationDuration = duration + 'ms';
          document.body.appendChild(ball);
          setTimeout(()=> ball.remove(), duration + 800);
        }
        for(let i=0;i<16;i++){ setTimeout(createBall, i*70); }
        setInterval(()=>{ createBall(); }, 720);
      })();
    </script>
  </body>
</html>
