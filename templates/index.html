<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Puissance 4 - Accueil</title>
    <link rel="stylesheet" href="/assets/static/style/Style.css">
  </head>
  <body>
    <!-- Vid√©o de fond -->
    <video autoplay muted loop id="fondquibrille">
      <source src="/assets/video/Arri√©replan.mp4.mp4" type="video/mp4">
    </video>

    <!-- Overlay sombre pour am√©liorer la lisibilit√© -->
    <div class="overlay"></div>

    <header class="site-header">
      <nav class="nav">
        <!-- Brand removed per user request -->
        <div class="nav-actions">
          <button id="mode-toggle" class="mode-toggle" aria-label="Basculer mode jour nuit">‚òÄÔ∏è/üåô</button>
        </div>
      </nav>
    </header>

    <main class="hero">
      <div class="hero-content">
        <!-- Personalised home card -->
        <div class="home-card">
          <div class="logo">P4</div>
          <h2 class="card-title">Puissance 4</h2>

          <div class="hero-cta">
            <a href="/auth" class="start-button large">Commencer une partie</a>
          </div>

          <!-- theme selector -->
          <div class="theme-selector" style="margin-top:18px;">
            <label for="theme-select" style="display:block;margin-bottom:8px;color:rgba(255,255,255,0.9);">Choisir un th√®me :</label>
            <select id="theme-select" class="button-class" style="padding:8px 12px;border-radius:8px;">
              <option value="principal">Th√®me principal</option>
              <option value="sport">Th√®me sport</option>
              <option value="pokemon">Th√®me Pok√©mon</option>
            </select>
          </div>

          <!-- mini-board preview -->
          <div class="mini-board" aria-hidden="true">
            <!-- 7x6 small cells generated by CSS/JS -->
            <div class="mini-grid"></div>
          </div>
        </div>
      </div>
      
    </main>

    <footer class="site-footer">
      <div class="footer-inner">¬© Puissance 4 ‚Äî Projet personnel</div>
    </footer>
    <script>
      // Mode jour / nuit : lit et √©crit dans localStorage, applique classe sur body
      (function(){
        const body = document.body;
        const toggle = document.getElementById('mode-toggle');
        const themeSelect = document.getElementById('theme-select');
        const saved = localStorage.getItem('pf4-mode') || 'night';
        function applyMode(mode){
          if(mode === 'day'){
            body.classList.remove('night-mode');
            body.classList.add('day-mode');
          } else {
            body.classList.remove('day-mode');
            body.classList.add('night-mode');
          }
        }
        applyMode(saved);
        toggle.addEventListener('click', function(){
          const current = body.classList.contains('day-mode') ? 'day' : 'night';
          const next = current === 'day' ? 'night' : 'day';
          localStorage.setItem('pf4-mode', next);
          applyMode(next);
        });
        // Theme persistence: apply saved theme and wire selector
        let savedTheme = localStorage.getItem('pf4-theme') || 'principal';
        // If a previous value used the removed 'ynov' theme, fall back to principal
        if (savedTheme === 'ynov') savedTheme = 'principal';
        function applyThemeToPage(theme){
          body.classList.remove('theme-principal','theme-sport','theme-dragon','theme-pokemon');
          body.classList.add('theme-' + theme);
          // swap background video if available; fallback to themed overlay/background
          const vid = document.getElementById('fondquibrille');
          if (vid && vid.tagName.toLowerCase() === 'video') {
            const source = vid.querySelector('source');
            // map known files (case-sensitive on disk) to the videos you added
            let candidate;
            if (theme === 'principal') {
              candidate = '/assets/video/Arri√©replan.mp4.mp4';
            } else if (theme === 'dragon' || theme === 'pokemon') {
              // use the pokemon video file for the renamed theme
              candidate = '/assets/video/pokemon.mp4';
            } else if (theme === 'sport') {
              candidate = '/assets/video/FOOTBALL.MP4.mp4';
            } else {
              candidate = '/assets/video/' + theme + '-background.mp4';
            }
            if (source) {
              // attempt to switch source; browser will fallback if file missing
              source.src = candidate;
              vid.load();
            }
          }
        }
        applyThemeToPage(savedTheme);
        if(themeSelect){
          themeSelect.value = savedTheme;
          themeSelect.addEventListener('change', function(e){
            const t = e.target.value || 'principal';
            localStorage.setItem('pf4-theme', t);
            applyThemeToPage(t);
          });
        }
        // mini-board render + simple animation
        const miniGrid = document.querySelector('.mini-grid');
        if(miniGrid){
          // create 7*6 small cells
          for(let r=0;r<6;r++){
            for(let c=0;c<7;c++){
              const cell = document.createElement('div');
              cell.className = 'mini-cell';
              miniGrid.appendChild(cell);
            }
          }
          // periodically drop a random colored piece
          function dropOnce(){
            const rect = miniGrid.getBoundingClientRect();
            const drop = document.createElement('div');
            const isRed = Math.random() > 0.5;
            drop.className = 'mini-drop ' + (isRed ? 'red' : 'yellow');
            miniGrid.parentElement.appendChild(drop);
            // pick random column and animate towards bottom
            const col = Math.floor(Math.random()*7);
            const targetCell = miniGrid.children[(5)*7 + col];
            const targetRect = targetCell.getBoundingClientRect();
            const startLeft = targetRect.left - rect.left;
            drop.style.left = (startLeft) + 'px';
            drop.style.top = (-30) + 'px';
            drop.style.opacity = '1';
            // animate using requestAnimationFrame
            const endTop = targetRect.top - rect.top;
            let t0 = null;
            function anim(ts){
              if(!t0) t0 = ts; const p = Math.min(1,(ts-t0)/700);
              drop.style.top = (-30 + (endTop + 4) * p) + 'px';
              if(p<1) requestAnimationFrame(anim);
              else setTimeout(()=>drop.remove(),600);
            }
            requestAnimationFrame(anim);
          }
          setInterval(dropOnce, 1800);
        }
      })();
    </script>
    <script>
      (function(){
        const rand = (min,max)=> Math.random()*(max-min)+min;
        function createBall(){
          // reduce decorative balls on small screens
          if (window.innerWidth < 480 && Math.random() > 0.45) return;
          const ball = document.createElement('div');
          // on the homepage use black/blue balls to match the background
          ball.className = 'falling-ball ' + (Math.random()>0.5? 'black':'blue');
          const size = Math.round(rand(12,44));
          ball.style.width = size + 'px';
          ball.style.height = size + 'px';
          ball.style.left = Math.round(rand(0, window.innerWidth - size)) + 'px';
          const duration = Math.round(rand(4200, 11000));
          ball.style.animationDuration = duration + 'ms';
          document.body.appendChild(ball);
          setTimeout(()=> ball.remove(), duration + 800);
        }
        // initial burst
        for(let i=0;i<18;i++){ setTimeout(createBall, i*70); }
        // continuous spawn
        setInterval(()=>{ createBall(); }, 720);
      })();
    </script>
    <!-- DEBUG: log clicks and topmost element to help diagnose unclickable CTA -->
    <script>
      (function(){
        window.addEventListener('click', function(ev){
          try{
            const pt = { x: ev.clientX, y: ev.clientY };
            const el = document.elementFromPoint(pt.x, pt.y);
            console.log('[DEBUG CLICK] event.target=', ev.target, '\n elementFromPoint=', el, '\n client=', pt);
            if(el){
              // briefly flash the element to visualise stacking
              const orig = el.style.boxShadow;
              el.style.boxShadow = '0 0 0 3px rgba(255,0,0,0.9)';
              setTimeout(()=> el.style.boxShadow = orig, 400);
            }
          }catch(e){ console.log('[DEBUG CLICK] error', e); }
        }, true);
      })();
    </script>
  </body>
</html>