<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Connexion / Inscription - Puissance 4</title>
    <link rel="stylesheet" href="/assets/static/style/Style.css">
    <style>
      /* small additions scoped to this page */
      .auth-wrap{max-width:520px;margin:48px auto;background:rgba(0,0,0,0.35);padding:24px;border-radius:12px}
      .auth-actions{display:flex;gap:12px;margin-bottom:14px;justify-content:center}
      .tab-button{flex:1;padding:12px 14px;border-radius:10px;cursor:pointer;background:rgba(255,255,255,0.06);color:#fff;border:none;font-weight:700}
      .tab-button.active{background:var(--accent, #ffcc00);color:#000;box-shadow:0 6px 18px rgba(0,0,0,0.45)}
      .tabs{display:none} /* keep legacy tabs hidden, use primary buttons */
      .input-row{margin:8px 0}
      .small-note{font-size:0.9rem;color:rgba(255,255,255,0.8);margin-top:6px}
      /* ensure auth card sits above decorative falling balls */
      .auth-wrap{position:relative;z-index:6}
    </style>
  </head>
  <body>
    <video autoplay muted loop id="fondquibrille">
      <source src="/assets/video/Arriéreplan.mp4.mp4" type="video/mp4">
    </video>
    <div class="overlay"></div>
    <header class="site-header">
      <nav class="nav">
        <div class="brand"><a href="/" class="brand-link">Puissance 4</a></div>
      </nav>
    </header>

    <main class="hero">
      <div class="hero-content">
        <div class="auth-wrap">
          <div class="auth-actions">
            <button id="btn-show-login" class="tab-button active">Se connecter</button>
            <button id="btn-show-register" class="tab-button">S'inscrire</button>
          </div>
          <div class="tabs" aria-hidden="true">
            <div id="tab-login" class="tab active">Se connecter</div>
            <div id="tab-register" class="tab">Créer un compte</div>
          </div>

          <div id="login-view">
            <div class="input-row"><input id="login-username" class="input-name" placeholder="Pseudo ou email"/></div>
            <div class="input-row"><input id="login-password" type="password" class="input-name" placeholder="Mot de passe"/></div>
            <div style="margin-top:12px;">
              <button id="btn-login" class="start-button">Se connecter</button>
              <a href="/" class="button-class" style="margin-left:12px">Annuler</a>
            </div>
            <div class="small-note">Remarque : cette démo n'utilise pas de backend. Une connexion simulée sera effectuée en localStorage.</div>
          </div>

          <div id="register-view" style="display:none;">
            <div class="input-row"><input id="reg-username" class="input-name" placeholder="Pseudo"/></div>
            <div class="input-row"><input id="reg-email" class="input-name" placeholder="Email (optionnel)"/></div>
            <div class="input-row"><input id="reg-password" type="password" class="input-name" placeholder="Mot de passe"/></div>
            <div style="margin-top:12px;">
              <button id="btn-register" class="start-button">Créer un compte</button>
              <a href="/" class="button-class" style="margin-left:12px">Annuler</a>
            </div>
            <div class="small-note">Les comptes sont simplement stockés localement pour la démo (localStorage).</div>
          </div>
        </div>
      </div>
    </main>

    <script>
      (function(){
        // tabs
        const tabLogin = document.getElementById('tab-login');
        const tabReg = document.getElementById('tab-register');
        const loginView = document.getElementById('login-view');
        const regView = document.getElementById('register-view');
        function showLogin(){ tabLogin.classList.add('active'); tabReg.classList.remove('active'); loginView.style.display='block'; regView.style.display='none'; }
        function showReg(){ tabLogin.classList.remove('active'); tabReg.classList.add('active'); loginView.style.display='none'; regView.style.display='block'; }
        tabLogin.addEventListener('click', showLogin); tabReg.addEventListener('click', showReg);

  // simple localStorage-backed accounts (demo only)
        function loadAccounts(){ try{ return JSON.parse(localStorage.getItem('pf4-accounts')||'{}'); }catch(e){return{}} }
        function saveAccounts(ac){ localStorage.setItem('pf4-accounts', JSON.stringify(ac)); }

        document.getElementById('btn-register').addEventListener('click', function(){
          const u = document.getElementById('reg-username').value.trim();
          const e = document.getElementById('reg-email').value.trim();
          const p = document.getElementById('reg-password').value;
          if(!u || !p){ alert('Veuillez fournir au moins un pseudo et un mot de passe.'); return; }
          const ac = loadAccounts();
          if(ac[u]){ alert('Ce pseudo existe déjà. Choisis-en un autre.'); return; }
          ac[u] = { email: e, password: p };
          saveAccounts(ac);
          // auto-login after register
          localStorage.setItem('pf4-user', JSON.stringify({ username: u }));
          localStorage.setItem('pf4-authenticated','1');
          // redirect to start page
          location.href = '/start';
        });

        document.getElementById('btn-login').addEventListener('click', function(){
          const u = document.getElementById('login-username').value.trim();
          const p = document.getElementById('login-password').value;
          if(!u || !p){ alert('Veuillez fournir pseudo/email et mot de passe.'); return; }
          const ac = loadAccounts();
          // attempt login by username
          if(ac[u] && ac[u].password === p){
            localStorage.setItem('pf4-user', JSON.stringify({ username: u }));
            localStorage.setItem('pf4-authenticated','1');
            location.href = '/start';
            return;
          }
          // try to match by email
          for(const k in ac){ if(ac[k].email && ac[k].email === u && ac[k].password === p){
            localStorage.setItem('pf4-user', JSON.stringify({ username: k }));
            localStorage.setItem('pf4-authenticated','1');
            location.href = '/start';
            return;
          }}
          alert('Identifiants incorrects (démo locale).');
        });

        // if already authenticated, forward to start
        try{
          if(localStorage.getItem('pf4-authenticated')){
            // small delay to let user see the page if they navigated here manually
            setTimeout(()=> location.href='/start', 250);
          }
        }catch(e){}

        // apply saved theme for consistency and swap background video if available
        const savedTheme = localStorage.getItem('pf4-theme') || 'principal';
        if(savedTheme) document.body.classList.add('theme-' + savedTheme);
        (function applyAuthBackground(theme){
          const vid = document.getElementById('fondquibrille');
          if(!vid) return;
          const source = vid.querySelector('source');
          let candidate = '/assets/video/Arriéreplan.mp4.mp4';
          if(theme === 'principal') candidate = '/assets/video/Arriéreplan.mp4.mp4';
          else if(theme === 'dragon' || theme === 'pokemon') candidate = '/assets/video/DRAGONBALL.mp4';
          else if(theme === 'sport') candidate = '/assets/video/FOOTBALL.MP4.mp4';
          else if(theme === 'pokemon') candidate = '/assets/video/POKEMON.mp4';
          else candidate = '/assets/video/Arriéreplan.mp4.mp4';
          if(source){ source.src = candidate; vid.load(); }
        })(savedTheme);
      })();
    </script>
  </body>
</html>
